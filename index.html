<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Resistance</title>
</head>
<body>
    <form id="main_form">
    <script src="resistance.js"></script>

    <table>
      <tr>
        <td><input type="button" id="start_button" onclick="startGame()" value="Start game for "></td>
        <td></td>
        <td><input type="number" id="number_of_players_id" value="10"></td>
        <td><input type="text" id="game_phase_id" readonly value = "New"></td>
        <td></td>
        <td></td>
      </tr>
      <tr class="player_1_name_tr_class">
        <td><label>Player 1</label></td>
        <td><input type="checkbox" name="selected" id="player_1_checkbox_id" disabled></td>
        <td><input type="text" id="player_1_name_id" value="A"></td>
        <td><input type="text" id="player_1_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_1_selected_id"></td>
        <td><input type="text" id="player_1_cards_id" readonly></td>
      </tr>
      <tr class="player_2_name_tr_class">
        <td><label>Player 2</label></td>
        <td><input type="checkbox" name="selected" id="player_2_checkbox_id" disabled></td>
        <td><input type="text" id="player_2_name_id" value="B"></td>
        <td><input type="text" id="player_2_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_2_selected_id"></td>
        <td><input type="text" id="player_2_cards_id" readonly></td>
      </tr>
      <tr class="player_3_name_tr_class">
        <td><label>Player 3</label></td>
        <td><input type="checkbox" name="selected" id="player_3_checkbox_id" disabled></td>
        <td><input type="text" id="player_3_name_id" value="C"></td>
        <td><input type="text" id="player_3_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_3_selected_id"></td>
        <td><input type="text" id="player_3_cards_id" readonly></td>
      </tr>
      <tr class="player_4_name_tr_class">
        <td><label>Player 4</label></td>
        <td><input type="checkbox" name="selected" id="player_4_checkbox_id" disabled></td>
        <td><input type="text" id="player_4_name_id" value="D"></td>
        <td><input type="text" id="player_4_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_4_selected_id"></td>
        <td><input type="text" id="player_4_cards_id" readonly></td>
      </tr>
      <tr class="player_5_name_tr_class">
        <td><label>Player 5</label></td>
        <td><input type="checkbox" name="selected" id="player_5_checkbox_id" disabled></td>
        <td><input type="text" id="player_5_name_id" value="E"></td>
        <td><input type="text" id="player_5_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_5_selected_id"></td>
        <td><input type="text" id="player_5_cards_id" readonly></td>
      </tr>
      <tr class="player_6_name_tr_class">
        <td><label>Player 6</label></td>
        <td><input type="checkbox" name="selected" id="player_6_checkbox_id" disabled></td>
        <td><input type="text" id="player_6_name_id" value="F"></td>
        <td><input type="text" id="player_6_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_6_selected_id"></td>
        <td><input type="text" id="player_6_cards_id" readonly></td>
      </tr>
      <tr class="player_7_name_tr_class">
        <td><label>Player 7</label></td>
        <td><input type="checkbox" name="selected" id="player_7_checkbox_id" disabled></td>
        <td><input type="text" id="player_7_name_id" value="G"></td>
        <td><input type="text" id="player_7_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_7_selected_id"></td>
        <td><input type="text" id="player_7_cards_id" readonly></td>
      </tr>
      <tr class="player_8_name_tr_class">
        <td><label>Player 8</label></td>
        <td><input type="checkbox" name="selected" id="player_8_checkbox_id" disabled></td>
        <td><input type="text" id="player_8_name_id" value="H"></td>
        <td><input type="text" id="player_8_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_8_selected_id"></td>
        <td><input type="text" id="player_8_cards_id" readonly></td>
      </tr>
      <tr class="player_9_name_tr_class">
        <td><label>Player 9</label></td>
        <td><input type="checkbox" name="selected" id="player_9_checkbox_id" disabled></td>
        <td><input type="text" id="player_9_name_id" value="I"></td>
        <td><input type="text" id="player_9_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_9_selected_id"></td>
        <td><input type="text" id="player_9_cards_id" readonly></td>
      </tr>
      <tr class="player_10_name_tr_class">
        <td><label>Player 10</label></td>
        <td><input type="checkbox" name="selected" id="player_10_checkbox_id" disabled></td>
        <td><input type="text" id="player_10_name_id" value="J"></td>
        <td><input type="text" id="player_10_role_id" readonly></td>
        <td><input type="radio" name="selected" id="player_10_selected_id"></td>
        <td><input type="text" id="player_10_cards_id" readonly></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td><input type="button" id="nominate_button" onclick="nominate()" value="Nominate" disabled></td>
        <td></td>
        <td></td>
        <td><input type="button" id="give_button" onclick="giveCard()" value="Give" disabled></td>
      </tr>
    </table>

    <table>
      <tr class="mission_1_tr_class">
        <td><label>Mission 1</label></td>
        <td><input type="number" id="mission_1_required_players_id" value="" disabled></td>
        <td><input type="text" id="mission_1_participants_id" value="" disabled></td>
        <td><input type="checkbox" id="mission_1_result_id" value="" disabled></td>
      </tr>
      <tr class="mission_2_tr_class">
        <td><label>Mission 2</label></td>
        <td><input type="number" id="mission_2_required_players_id" value="" disabled></td>
        <td><input type="text" id="mission_2_participants_id" value="" disabled></td>
        <td><input type="checkbox" id="mission_2_result_id" value="" disabled></td>
      </tr>
      <tr class="mission_3_tr_class">
        <td><label>Mission 3</label></td>
        <td><input type="number" id="mission_3_required_players_id" value="" disabled></td>
        <td><input type="text" id="mission_3_participants_id" value="" disabled></td>
        <td><input type="checkbox" id="mission_3_result_id" value="" disabled></td>
      </tr>
      <tr class="mission_4_tr_class">
        <td><label>Mission 4</label></td>
        <td><input type="number" id="mission_4_required_players_id" value="" disabled></td>
        <td><input type="text" id="mission_4_participants_id" value="" disabled></td>
        <td><input type="checkbox" id="mission_4_result_id" value="" disabled></td>
      </tr>
      <tr class="mission_5_tr_class">
        <td><label>Mission 5</label></td>
        <td><input type="number" id="mission_5_required_players_id" value="" disabled></td>
        <td><input type="text" id="mission_5_participants_id" value="" disabled></td>
        <td><input type="checkbox" id="mission_5_result_id" value="" disabled></td>
      </tr>
    </table>

    <script>
        var game = null;

        function startGame() {
            var numberOfPlayers = parseInt(document.getElementById('number_of_players_id').value);

            if (numberOfPlayers < 5 || numberOfPlayers > 10) {
                alert('Number of players must be from 5 up to 10!')
                return;
            }

            var players = [];
            for (var i = 0; i < numberOfPlayers; i++) {
                players.push(new Player(document.getElementById('player_' + (i + 1) + '_name_id').value, i));
            }

            game = new Game(numberOfPlayers, players);

            game.start();

            refreshView();
        }

        function giveCard() {
            var selectedPlayer = getSelectedPlayer();

            if (selectedPlayer == game.leader) {
                alert("You can't give card to yourself");
                return;
            }

            if (selectedPlayer.cardToTake) {
                alert(selectedPlayer.name + " already got a card");
                return;
            }

            game.giveCard(game.leader.cardsToGive[0], selectedPlayer);

            document.getElementById('player_' + (selectedPlayer.id + 1) + '_selected_id').checked = false;

            refreshView();
        }

        function nominate() {
            var nominees = getCheckedPlayers();

            if (nominees.length != game.currentMission().requiredPlayers) {
                alert(nominees.length + " people have been nominated, but required " + game.currentMission().requiredPlayers + "!");
                return;
            }

            if (confirm("Are you sure?")) {
                game.nominate(nominees);
                alert("Coming soon...");
            }

            refreshView();
        }

        function refreshView() {
            document.getElementById('number_of_players_id').value = game.numberOfPlayers;

            document.getElementById('game_phase_id').value = game.phase;

            for (var i = 0; i < 10; i++) {
                if (i < game.numberOfPlayers) {
                    var p = game.players[i];
                    document.getElementsByClassName('player_' + (i + 1) + '_name_tr_class')[0].style.backgroundColor = 'PaleGreen';
                    document.getElementById('player_' + (i + 1) + '_role_id').value = p.role.name;

                    var cards = "";
                    p.cardsToGive.forEach(function(c) {
                        cards += c.name + " ";
                    });
                    p.cards.forEach(function(c) {
                        cards += c.name + " ";
                    });
                    cards += (p.cardToTake && p.cardToTake.name) || "";
                    document.getElementById('player_' + (i + 1) + '_cards_id').value = cards;
                    document.getElementById('player_' + (i + 1) + '_selected_id').disabled = !(game.phase == Rules.Phases.MissionCards);
                    document.getElementById('player_' + (i + 1) + '_checkbox_id').disabled = !(game.phase == Rules.Phases.MissionVote);
                } else {
                    document.getElementsByClassName('player_' + (i + 1) + '_name_tr_class')[0].style.backgroundColor = 'White';
                    document.getElementById('player_' + (i + 1) + '_role_id').value = "";
                    document.getElementById('player_' + (i + 1) + '_cards_id').value = "";
                    document.getElementById('player_' + (i + 1) + '_selected_id').disabled = true;
                    document.getElementById('player_' + (i + 1) + '_checkbox_id').disabled = true;
                }
            }

            document.getElementsByClassName('player_' + (game.leader.id + 1) + '_name_tr_class')[0].style.backgroundColor = 'SkyBlue';

            document.getElementById('give_button').disabled = !(game.phase == Rules.Phases.MissionCards);

            document.getElementById('nominate_button').disabled = !(game.phase == Rules.Phases.MissionVote);

            for (var i = 0; i < 5; i++) {
                document.getElementById('mission_' + (i + 1) + '_required_players_id').value = game.missions[i].requiredPlayers;
                document.getElementById('mission_' + (i + 1) + '_participants_id').value = game.missions[i].participants;
                document.getElementById('mission_' + (i + 1) + '_result_id').checked = game.missions[i].result;
                if (i == game.missionNumber - 1) {
                    document.getElementsByClassName('mission_' + (i + 1) + '_tr_class')[0].style.backgroundColor = 'PaleGreen';
                } else {
                    document.getElementsByClassName('mission_' + (i + 1) + '_tr_class')[0].style.backgroundColor = 'White';
                }
            }
        }

        function getSelectedPlayer() {
            for (var i = 0; i < 10; i++) {
                if (document.getElementById('player_' + (i + 1) + '_selected_id').checked) {
                    return game.players[i];
                }
            }
            return null;
        }

        function getCheckedPlayers() {
            var selected = [];
            for (var i = 0; i < 10; i++) {
                if (document.getElementById('player_' + (i + 1) + '_checkbox_id').checked) {
                    selected.push(game.players[i]);
                }
            }
            return selected;
        }
    </script>

    </form>
</body>
</html>